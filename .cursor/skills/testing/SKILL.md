---
name: testing
description: ts/tsx編集時のテスト運用（Vitest + WXT）
---

# Overview

このリポジトリは **Vitest + WXT (`WxtVitest()` plugin)** でテストします。`ts` / `tsx` を編集する際は、変更箇所に対応するテストを **同じディレクトリに同居**させ、必要最小限の実行で差分の安全性を担保します。

## 配置・命名ルール（必須）
- **テストは `tests/` に作らない**。対象ファイルと同じディレクトリに置く
- **命名**: `*.test.ts` / `*.test.tsx`（例: `lib/utils.ts` → `lib/utils.test.ts`）
- **対象範囲**: 変更した関数/コンポーネント単位でテストを追加・更新（過剰なE2E化は避ける）

## ts / tsx 編集時のガイドライン（簡潔版）
- **ロジック変更（ts）**
  - 仕様が変わるなら **先に期待値をテストに反映** → 実装を合わせる
  - 外部依存は極力薄く（純関数化 / 小さなユーティリティに分離）してテストしやすくする
- **UI変更（tsx）**
  - 重要な表示/分岐/イベント（クリック等）はテストで担保（「表示されるべき文言」「無効化される」など）
  - DOMの詳細実装に依存しすぎず、ユーザー視点（role/text）を優先
- **拡張API（WXT）に触れる変更**
  - `vitest.config.ts` は `WxtVitest()` を使う前提。ブラウザ拡張コンテキストに依存する箇所は、WXTが提供するテスト環境/モックを優先して利用する

## 実行コマンド（作業中/CI）
- **テスト（watch）**: `npm test`
- **テスト（単発）**: `npm run test:run`
- **型チェック**: `npm run compile`
- **Lint/Format**: `npm run lint` / `npm run lint:fix`

## 追加の約束（迷ったらこれ）
- 1ファイル編集したら「**型 + lint + 影響範囲のテスト**」を最低限通す
- バグ修正は **再現テストを追加**してから直す（回帰防止を優先）
